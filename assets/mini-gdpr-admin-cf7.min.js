!function(){"use strict";class t{constructor(t){this.container=t,this.meta=JSON.parse(t.getAttribute("data-mwg-cf7-forms")),this.spinner=t.querySelector(".pp-spinner"),this.tbody=t.querySelector("tbody"),this._initTimeout=null}init(){this.populateRows(),this.bindEvents(),this.refreshTable(this.meta.forms),this.hideSpinnerDelayed()}populateRows(){const{forms:t,labels:e}=this.meta;let n=0;for(const s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const i=t[s],o=document.createElement("tr");o.setAttribute("data-form-name",s);const a=document.createElement("td");a.className="align-left",a.textContent=i.title,o.appendChild(a);const l=document.createElement("td");l.className="align-centre",l.innerHTML='<span class="dashicons dashicons-yes" style="display:none;"></span><span class="dashicons dashicons-no" style="display:none;"></span>',o.appendChild(l);const r=document.createElement("td"),d=document.createElement("button");d.type="button",d.className="button install-consent",d.disabled=!0,d.dataset.formId=String(i.formId),d.textContent=e.installConsentButton,r.appendChild(d),o.appendChild(r),this.tbody.appendChild(o),++n}if(0===n){const t=this.container.querySelector(".mwg-cf7-no-forms");t&&(t.style.display="")}}bindEvents(){this.tbody.addEventListener("click",t=>{const e=t.target.closest(".install-consent");e&&!e.disabled&&(t.preventDefault(),this.installConsent(parseInt(e.dataset.formId,10)))})}refreshTable(t){if(t)for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const n=this.tbody.querySelector(`tr[data-form-name="${e}"]`);if(!n)continue;const s=n.querySelector(".dashicons-yes"),i=n.querySelector(".dashicons-no"),o=n.querySelector(".install-consent");t[e].isConsentInstalled?(i&&(i.style.display="none"),s&&(s.style.display=""),o&&(o.disabled=!0)):(s&&(s.style.display="none"),i&&(i.style.display=""),o&&(o.disabled=!1))}}async installConsent(t){const e=this.tbody.querySelector(`button[data-form-id="${t}"]`);e&&(e.disabled=!0),this.showSpinner();const n=new FormData;n.append("action",this.meta.action),n.append("nonce",this.meta.nonce),n.append("formId",String(t));try{const t=await fetch(ajaxurl,{method:"POST",body:n}),e=await t.json();this.refreshTable(e.forms)}catch(t){console.error("Mini GDPR: CF7 install consent request failed.",t),e&&(e.disabled=!1)}finally{this.hideSpinner()}}showSpinner(){this.spinner&&(this.spinner.style.display="")}hideSpinner(){this.spinner&&(this.spinner.style.display="none")}hideSpinnerDelayed(){null!==this._initTimeout&&clearTimeout(this._initTimeout),this._initTimeout=setTimeout(()=>{this.hideSpinner(),this._initTimeout=null},250)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-mwg-cf7-forms]").forEach(e=>{new t(e).init()})})}();
//# sourceMappingURL=mini-gdpr-admin-cf7.min.js.map